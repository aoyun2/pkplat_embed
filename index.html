<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover" />
  <title>Web DS</title>
  <link rel="shortcut icon" type="image/x-icon" href="favicon.ico">
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="./css/app.css" />
</head>
<body>
  <div class="hud" id="hud">
    <div class="L">
      <button class="hbtn" id="btnControls">Controls</button>
      <button class="hbtn" id="btnSaves">Saves</button>
    </div>
    <div class="R">
      <span class="tag" id="tagSave">save: —</span>
    </div>
  </div>

  <desmond-player id="player"></desmond-player>

  <div id="loader">
    <div class="loader-card">
      <div class="loader-title" id="loaderTitle">Loading</div>
      <div class="track"><div class="fill" id="bar"></div></div>
      <div class="loader-meta">
        <div><span class="val" id="dl">0 MB</span> loaded</div>
        <div><span class="val" id="pct">0%</span></div>
      </div>
      <div class="loader-sub" id="sub">Initialising…</div>
    </div>
  </div>

  <div id="unmute">
    <div style="text-align:center">
      <div class="icon">
        <svg viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/></svg>
      </div>
      <div class="lbl">Tap to enable audio</div>
    </div>
  </div>

  <!-- Virtual Gamepad -->
  <div id="gamepad">
    <div class="gp-shoulders">
      <div class="shoulder" data-btn="10">L</div>
      <div class="shoulder" data-btn="11">R</div>
    </div>
    <div class="gp-main">
      <div class="dpad-zone" id="dpadZone">
        <div class="dp-bg dp-v"></div>
        <div class="dp-bg dp-h"></div>
        <div class="dp-center"></div>
        <div class="dp-arrow up"    id="arU"></div>
        <div class="dp-arrow down"  id="arD"></div>
        <div class="dp-arrow left"  id="arL"></div>
        <div class="dp-arrow right" id="arR"></div>
      </div>
      <div class="gp-center">
        <div class="meta-btn" data-btn="4">sel</div>
        <div class="meta-btn" data-btn="5">start</div>
      </div>
      <div class="abxy-zone" id="abxyZone">
        <div class="face-btn btn-x" data-btn="9">X</div>
        <div class="face-btn btn-y" data-btn="8">Y</div>
        <div class="face-btn btn-a" data-btn="7">A</div>
        <div class="face-btn btn-b" data-btn="6">B</div>
      </div>
    </div>
  </div>

  <!-- Modal -->
  <div id="overlay">
    <div class="modal">
      <div class="modal-head">
        <h2 id="modalTitle">Controls</h2>
        <button class="close-btn" id="btnClose">ESC</button>
      </div>
      <div id="panelControls">
        <div class="section">
          <div class="section-label">Keyboard</div>
          <div class="kv"><span class="label">D-Pad</span><span class="value">↑ ↓ ← →</span></div>
          <div class="kv"><span class="label">A</span><span class="value">Z</span></div>
          <div class="kv"><span class="label">B</span><span class="value">X</span></div>
          <div class="kv"><span class="label">X</span><span class="value">S</span></div>
          <div class="kv"><span class="label">Y</span><span class="value">A</span></div>
          <div class="kv"><span class="label">L / R</span><span class="value">Q / W</span></div>
          <div class="kv"><span class="label">Start</span><span class="value">Enter</span></div>
          <div class="kv"><span class="label">Select</span><span class="value">Shift</span></div>
        </div>
        <div class="section">
          <div class="section-label">Touch</div>
          <div class="info">Tap the bottom DS screen for stylus input. On mobile, virtual controls appear automatically.</div>
        </div>
      </div>
      <div id="panelSaves" style="display:none;">
        <div class="section">
          <div class="section-label">Auto-save</div>
          <div class="info">Battery saves persist to browser storage automatically. On reload, saves restore before the ROM boots.</div>
          <div class="actions">
            <button class="hbtn" id="btnExport">Export .dsv</button>
            <label class="hbtn" for="importFile" style="cursor:pointer">Import .dsv</label>
            <input id="importFile" type="file" accept=".dsv,.sav" hidden />
            <button class="hbtn red" id="btnClear">Delete save</button>
          </div>
          <div class="status" id="saveStatus">checking…</div>
          <div class="status" id="saveKey">key: —</div>
        </div>
      </div>
    </div>
  </div>

  <script src="./js/desmond.min.js"></script>
  <script src="./js/boot.js"></script>
</body>
</html>
