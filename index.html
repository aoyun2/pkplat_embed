<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>Web DS</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="./css/app.css" />
</head>
<body>
  <!-- HUD -->
  <div class="hud" id="hud">
    <div class="L">
      <button class="hbtn" id="btnControls">Controls</button>
      <button class="hbtn" id="btnSaves">Saves</button>
    </div>
    <div class="R">
      <span class="tag" id="tagSave">save: —</span>
    </div>
  </div>

  <!-- Emulator -->
  <desmond-player id="player"></desmond-player>

  <!-- Mobile touch controls -->
  <div id="touchControls" aria-label="Touch controls" role="group">
    <div class="touch-left" aria-label="D-pad">
      <button class="touch-btn dpad up" data-key="ArrowUp" aria-label="Up">▲</button>
      <button class="touch-btn dpad left" data-key="ArrowLeft" aria-label="Left">◀</button>
      <button class="touch-btn dpad right" data-key="ArrowRight" aria-label="Right">▶</button>
      <button class="touch-btn dpad down" data-key="ArrowDown" aria-label="Down">▼</button>
    </div>
    <div class="touch-mid">
      <button class="touch-btn util" data-key="Shift" aria-label="Select">Select</button>
      <button class="touch-btn util" data-key="Enter" aria-label="Start">Start</button>
    </div>
    <div class="touch-right" aria-label="Face buttons">
      <button class="touch-btn face y" data-key="a" aria-label="Y">Y</button>
      <button class="touch-btn face x" data-key="s" aria-label="X">X</button>
      <button class="touch-btn face b" data-key="x" aria-label="B">B</button>
      <button class="touch-btn face a" data-key="z" aria-label="A">A</button>
      <button class="touch-btn shoulder l" data-key="q" aria-label="L">L</button>
      <button class="touch-btn shoulder r" data-key="w" aria-label="R">R</button>
    </div>
  </div>

  <!-- Loader -->
  <div id="loader">
    <div class="loader-card">
      <div class="loader-title" id="loaderTitle">Loading</div>
      <div class="track"><div class="fill" id="bar"></div></div>
      <div class="loader-meta">
        <div><span class="val" id="dl">0 MB</span> downloaded</div>
        <div><span class="val" id="pct">0%</span></div>
      </div>
      <div class="loader-sub" id="sub">Downloading ROM…</div>
    </div>
  </div>

  <!-- Unmute overlay -->
  <div id="unmute">
    <div class="inner">
      <div class="icon">
        <svg viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/></svg>
      </div>
      <div class="label">Tap to enable audio</div>
    </div>
  </div>

  <!-- Modal -->
  <div id="overlay">
    <div class="modal">
      <div class="modal-head">
        <h2 id="modalTitle">Controls</h2>
        <button class="close-btn" id="btnClose">ESC</button>
      </div>
      <div id="panelControls">
        <div class="section">
          <div class="section-label">Keyboard mapping</div>
          <div class="kv"><span class="label">D-Pad</span><span class="value">↑ ↓ ← →</span></div>
          <div class="kv"><span class="label">A</span><span class="value">Z</span></div>
          <div class="kv"><span class="label">B</span><span class="value">X</span></div>
          <div class="kv"><span class="label">X</span><span class="value">S</span></div>
          <div class="kv"><span class="label">Y</span><span class="value">A</span></div>
          <div class="kv"><span class="label">L / R</span><span class="value">Q / W</span></div>
          <div class="kv"><span class="label">Start</span><span class="value">Enter</span></div>
          <div class="kv"><span class="label">Select</span><span class="value">Shift</span></div>
        </div>
        <div class="section">
          <div class="section-label">Touch</div>
          <div class="info">Click or tap the bottom DS screen for stylus input. On phones, on-screen controls appear automatically for D-pad, face buttons, shoulders, start, and select.</div>
        </div>
      </div>
      <div id="panelSaves" style="display:none;">
        <div class="section">
          <div class="section-label">Auto-save</div>
          <div class="info">Battery saves are written to the browser storage automatically whenever the game writes save data. On reload, saves restore before the ROM boots.</div>
          <div class="actions">
            <button class="hbtn" id="btnExport">Export .dsv</button>
            <label class="hbtn" for="importFile" style="cursor:pointer;">Import .dsv</label>
            <input id="importFile" type="file" accept=".dsv,.sav" hidden />
            <button class="hbtn red" id="btnClear">Delete save</button>
          </div>
          <div class="status" id="saveStatus">checking…</div>
          <div class="status" id="saveKey">key: —</div>
        </div>
        <div class="section">
          <div class="section-label">Embed note</div>
          <div class="info">If embedded in an iframe, browser storage may be blocked. In that case, use the Import/Export .dsv feature.</div>
        </div>
      </div>
    </div>
  </div>

  <script src="./js/desmond.min.js"></script>
  <script src="./js/boot.js"></script>
</body>
</html>
