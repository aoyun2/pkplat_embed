<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>NDS Player</title>
  <link rel="stylesheet" href="./css/app.css" />
</head>

<body>
  <div class="hud">
    <div class="group">
      <button class="btn" id="btnControls">Controls</button>
      <button class="btn" id="btnSaves">Saves</button>
    </div>
    <div class="group">
      <span class="pill" id="pillStorage">Storage: —</span>
      <span class="pill" id="pillGame">Game: —</span>
    </div>
  </div>

  <desmond-player id="player"></desmond-player>

  <div id="loader">
    <div class="card">
      <div class="row">
        <div class="title">Loading ROM</div>
        <div class="chip" id="pct">0%</div>
      </div>
      <div class="sub" id="sub">Downloading game data…</div>
      <div class="barWrap"><div class="bar" id="bar"></div></div>

      <div class="meta">
        <div><strong id="dl">0 MB</strong><div>Downloaded</div></div>
        <div><strong id="eta">—</strong><div>Speed / ETA</div></div>
      </div>

      <div class="note" id="note">
        If controls aren’t responding, tap/click the emulator once to focus it.
      </div>
    </div>
  </div>

  <!-- Modal Backdrop -->
  <div id="modalBack" hidden>
    <div id="modal">
      <div class="modalHeader">
        <h2 id="modalTitle">Controls</h2>
        <button class="btn" id="btnClose">Close</button>
      </div>

      <!-- Controls panel -->
      <div id="panelControls">
        <div class="grid">
          <div class="panel">
            <h3>Keyboard</h3>
            <div class="krow"><span>D-Pad</span><code class="k">Arrow keys</code></div>
            <div class="krow"><span>A</span><code class="k">Z</code></div>
            <div class="krow"><span>B</span><code class="k">X</code></div>
            <div class="krow"><span>Y</span><code class="k">A</code></div>
            <div class="krow"><span>X</span><code class="k">S</code></div>
            <div class="krow"><span>L</span><code class="k">Q</code></div>
            <div class="krow"><span>R</span><code class="k">W</code></div>
            <div class="krow"><span>Start</span><code class="k">Enter</code></div>
            <div class="krow"><span>Select</span><code class="k">Shift</code></div>
            <div class="krow"><span>Menu</span><code class="k">Esc</code></div>
          </div>
          <div class="panel">
            <h3>Layout</h3>
            <div class="ptext">
              Screens are <b>side-by-side</b>: left = top screen, right = bottom screen.
              They scale to fit your window while preserving the DS aspect ratio.
            </div>
          </div>
        </div>
      </div>

      <!-- Saves panel -->
      <div id="panelSaves" hidden>
        <div class="panel">
          <h3>Battery Saves</h3>
          <div class="ptext">
            Desmond stores save data in browser storage. This page also provides export/import as a fallback.
          </div>

          <div class="saveRow">
            <button class="btn" id="btnExport">Export save (.dsv)</button>
            <label class="btn" for="importFile" style="display:inline-block;">Import save (.dsv)</label>
            <input id="importFile" type="file" accept=".dsv,application/octet-stream" hidden />
            <button class="btn danger" id="btnClear">Clear save</button>
          </div>

          <div class="ptext small" id="saveStatus">Save status: —</div>
          <div class="ptext small" id="saveKey">Save key: —</div>
        </div>

        <div class="panel" style="margin-top:12px;">
          <h3>Notes about embeds</h3>
          <div class="ptext small">
            If this is embedded in a sandboxed iframe without <code>allow-same-origin</code>, storage APIs (IndexedDB/localStorage) may be blocked. :contentReference[oaicite:2]{index=2}
            Some browsers also partition iframe storage by top-level site, which can affect embedded persistence. :contentReference[oaicite:3]{index=3}
          </div>
        </div>
      </div>

    </div>
  </div>

  <script type="module" src="./js/main.js"></script>
</body>
</html>